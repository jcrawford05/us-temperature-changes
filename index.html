<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>U.S. Temperature Changes — DS 4630/CS 5630 Final Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
<header class="app-header">
    <div class="header-left">
        <h1>U.S. Temperature Changes: 1800-2012</h1>
        <p class="sub">DS 4630 / CS 5630 — Final Project</p>
    </div>

    <nav class="nav-menu">
        <button id="menu-btn" class="menu-button">☰ Menu</button>
        <div id="menu-dropdown" class="dropdown">
            <a href="#" id="about-link">About the Project</a>
            <a href="#" id="data-link">Data Source</a>
            <a href="./Documents/ProcessBook.pdf" target="_blank">Process Book (PDF)</a>
            <a href="https://youtu.be/iKoOKhreXxc" target="_blank">Project Screencast</a>
        </div>
    </nav>
</header>

<main class="layout">
    <section class="controls">
        <div class="date-control-row">
            <label for="year">
                <span>Date:</span>
                <strong id="year-label">2000</strong>
            </label>
            <div class="slider-with-play">
                <input type="range" id="year" min="1800" max="2020" step="1" value="2000" />
                <button id="play-pause-btn" class="play-button" title="Play/Pause animation">
                    <span id="play-icon">▶</span>
                </button>
            </div>
        </div>

        <div class="unit-toggle">
            <label for="unit-toggle">
                <span>Temperature Unit:</span>
                <div class="toggle-container">
                    <span class="unit-label-left">°F</span>
                    <label class="switch">
                        <input type="checkbox" id="unit-toggle" />
                        <span class="slider"></span>
                    </label>
                    <span class="unit-label-right">°C</span>
                </div>
            </label>
        </div>

        <div class="data-toggle">
            <label for="data-toggle">
                <span>Data View:</span>
                <div class="toggle-container">
                    <span class="data-label-left">Monthly</span>
                    <label class="switch">
                        <input type="checkbox" id="data-toggle" checked />
                        <span class="slider"></span>
                    </label>
                    <span class="data-label-right">Yearly</span>
                </div>
            </label>
        </div>

        <div class="legend" id="legend"></div>

        <section class="analytics">
            <h3>Analytics</h3>

            <div class="display-toggle">
                <label for="display-toggle">
                    <span>Display:</span>
                    <div class="toggle-container">
                        <span class="display-label-left">Avg Temp</span>
                        <label class="switch">
                            <input type="checkbox" id="display-toggle" />
                            <span class="slider"></span>
                        </label>
                        <span class="display-label-right">Δ Temp</span>
                    </div>
                </label>
            </div>

            <div class="range-row">
                <span class="range-caption">Base:</span>
                <input type="range" id="base-range" />
                <strong id="base-label">Jan-1800</strong>
            </div>

            <div class="range-row" id="end-row" style="display:none;">
                <span class="range-caption">End:</span>
                <input type="range" id="end-range" />
                <strong id="end-label">Jan-2000</strong>
            </div>

            <div class="extra-analytics">
                <div class="max-toggle">
                    <label for="max-toggle">
                        <span>Max Average Temp:</span>
                        <div class="toggle-container">
                            <label class="switch">
                                <input type="checkbox" id="max-toggle" />
                                <span class="slider"></span>
                            </label>
                        </div>
                    </label>
                </div>

                <div class="min-toggle">
                    <label for="min-toggle">
                        <span>Min Average Temp:</span>
                        <div class="toggle-container">
                            <label class="switch">
                                <input type="checkbox" id="min-toggle" />
                                <span class="slider"></span>
                            </label>
                        </div>
                    </label>
                </div>
            </div>
        </section>
    </section>

    <section class="viz">
        <div id="tooltip" class="tooltip" style="opacity:0;"></div>
        <svg id="map" width="980" height="600" role="img" aria-label="U.S. temperature map"></svg>
    </section>

    <!-- ============================
         MULTI STATE TREND SECTION
    ============================= -->
    <section class="multi-state-panel">
        <h2 class="section-title">Multi State Temperature Trends</h2>

        <!-- Filters -->
        <div class="multi-state-controls">
            <!-- Date range -->
            <div class="filter-group">
                <label for="trend-date-range" class="filter-label">Date range</label>
                <select id="trend-date-range" class="filter-select">
                    <option value="all" selected>All time</option>
                    <option value="1">Last 1 year</option>
                    <option value="5">Last 5 years</option>
                    <option value="10">Last 10 years</option>
                    <option value="100">Last 100 years</option>
                    <option value="custom">Custom</option>
                </select>
                <small id="trend-date-note" class="filter-note">
                    Preset ranges are relative to the latest year in the dataset.
                </small>
                <small id="trend-date-lock-note" class="filter-note" style="display:none;">
                    Date range is locked to the Base and End sliders in Analytics while Δ Temp is enabled.
                </small>

                <div id="trend-custom-range" class="custom-range-row">
                    <input type="date" id="trend-start-date" class="date-input" />
                    <span class="range-sep">to</span>
                    <input type="date" id="trend-end-date" class="date-input" />
                </div>
            </div>

            <!-- Included states -->
            <div class="filter-group">
                <label for="trend-state-mode" class="filter-label">Included states</label>
                <select id="trend-state-mode" class="filter-select">
                    <option value="top5" selected>Top 5 hottest</option>
                    <option value="bottom5">Bottom 5 coldest</option>
                    <option value="all">All states</option>
                    <option value="region">By region</option>
                    <option value="custom">Custom selection</option>
                </select>

                <div id="trend-region-block" class="sub-filter-row" style="display:none;">
                    <label for="trend-region-select" class="sub-filter-label">Region</label>
                    <select id="trend-region-select" class="filter-select">
                        <option value="northeast">Northeast</option>
                        <option value="midwest">Midwest</option>
                        <option value="south" selected>South</option>
                        <option value="west">West</option>
                    </select>
                </div>

                <div id="trend-custom-states-block" class="sub-filter-row" style="display:none;">
                    <label for="trend-custom-states" class="sub-filter-label">States</label>
                    <div id="trend-custom-states" class="scrollable-dropdown"></div>
                </div>
            </div>

            <div class="filter-actions">
                <button id="trend-reset-btn" type="button" class="reset-button">Reset</button>
            </div>
        </div>

        <!-- Line chart + legend -->
        <div class="multi-state-chart">
            <svg id="state-linechart"></svg>
            <div id="state-linechart-loading" class="loading-overlay" style="display:none;">
                Loading chart ...
            </div>
            <div id="state-linechart-legend" class="line-legend"></div>
        </div>

        <!-- Trends table -->
        <div class="trend-table-wrapper">
            <div id="trend-table-loading" class="loading-inline">
                Loading trends ...
            </div>
            <table id="trend-table" class="trend-table">
                <thead>
                <tr>
                    <th>State</th>
                    <th>Δ Temp</th>
                    <th>Trend</th>
                    <th>Start value</th>
                    <th>End value</th>
                    <th>Period</th>
                </tr>
                </thead>
                <tbody>
                <!-- rows filled in script.js -->
                </tbody>
            </table>
        </div>
    </section>
</main>

<footer class="app-footer"></footer>

<script src="./script.js?v=5"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // === MENU TOGGLE ===
        const menuBtn = document.getElementById('menu-btn');
        const dropdown = document.getElementById('menu-dropdown');

        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdown.classList.toggle('show');
        });

        window.addEventListener('click', (e) => {
            if (!menuBtn.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });


        // limit custom date range to data set
        const startInput = document.getElementById("trend-start-date");
        const endInput = document.getElementById("trend-end-date");

        if (startInput && endInput) {
            startInput.min = "1800-01-01";
            startInput.max = "2012-12-31";

            endInput.min = "1800-01-01";
            endInput.max = "2012-12-31";

            // Optional: set default values to dataset bounds
            startInput.value = "1800-01-01";
            endInput.value = "2012-12-31";
        }
 

        // === MODAL HANDLERS ===
        const aboutLink = document.getElementById('about-link');
        const dataLink = document.getElementById('data-link');
        const aboutModal = document.getElementById('about-modal');
        const dataModal = document.getElementById('data-modal');
        const closeBtns = document.querySelectorAll('.modal-close');

        if (aboutLink && aboutModal) {
            aboutLink.addEventListener('click', (e) => {
                e.preventDefault();
                aboutModal.classList.add('show');
                dropdown.classList.remove('show');
            });
        }

        if (dataLink && dataModal) {
            dataLink.addEventListener('click', (e) => {
                e.preventDefault();
                dataModal.classList.add('show');
                dropdown.classList.remove('show');
            });
        }

        closeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').classList.remove('show');
            });
        });

        window.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal.show');
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
    });
</script>

<!-- ===== ABOUT MODAL ===== -->
<div id="about-modal" class="modal">
    <div class="modal-content">
        <button class="modal-close">×</button>
        <h2>About This Project</h2>
        <p><strong>Course:</strong> Visualization for Data Science (DS 4630 / CS 5630)<br>
            <strong>Semester:</strong> Fall 2025<br>
            <strong>Instructor:</strong> Dr. Paul Rosen<br>
            <strong>Authors:</strong> Katelyn Abraham, James Crawford, Max Terranova</p>

        <p>Our first objective is to track how average temperatures in the United States have changed from the 19th
            century through today. Looking this far back lets us contextualize recent warming in the broader scope of
            history, rather than just the last few decades. By extending the timeline to the early 1800s, we capture key
            historical periods: the Industrial Revolution, the Second Industrial Revolution, and even the tail end of the
            Little Ice Age, when cooler conditions still shaped much of the Northern Hemisphere. This longer view makes it
            possible to see whether the shifts of the past century stand apart from natural variations or fit into a broader
            global trend. Using the Berkeley Earth dataset, which brings together millions of historical temperature
            records, we can trace those changes with enough resolution to show how today’s climate compares with that of the
            earlier baseline.
        </p>

        <p>The second objective is to take what we find and make it understandable to people outside of climate science.
            A lot of climate graphs are either overly technical or stripped down to the point of being unclear. We want
            to avoid both of those extremes. Our plan is to build straightforward visuals such as line charts, heat
            maps, and trend plots that show the main story without overwhelming the viewer. The idea is that someone
            looking at our charts should walk away with a clearer picture of how U.S. temperatures have shifted without
            needing to dig through a scientific paper to get there.
        </p>
    </div>
</div>

<!-- ===== DATA SOURCE MODAL ===== -->
<div id="data-modal" class="modal">
    <div class="modal-content">
        <button class="modal-close">×</button>
        <h2>Data Source</h2>
        <p>This project draws from the <strong>Berkeley Earth Surface Temperature Data</strong> compiled on Kaggle. The dataset consolidates millions of land-based and marine temperature records into a continuous global timeseries extending back to the 18th century. It provides a robust foundation for analyzing regional and historical temperature shifts with monthly and yearly granularity.</p>
        <p><a href="https://www.kaggle.com/datasets/berkeleyearth/climate-change-earth-surface-temperature-data" target="_blank">View dataset on Kaggle →</a></p>
    </div>
</div>

</body>
</html>
